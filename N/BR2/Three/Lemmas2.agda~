{-# OPTIONS  --safe #-}
{-# OPTIONS  --call-by-name #-}
{-# OPTIONS --termination-depth=4 #-}
open import Level using (0ℓ)

open import Relation.Binary using (Rel)
open import Relation.Binary.Definitions using (DecidableEquality)
open import Relation.Binary.Morphism.Definitions using (Homomorphic₂)
open import Relation.Binary.PropositionalEquality using (_≡_ ; _≢_ ; inspect ; setoid ; module ≡-Reasoning ; _≗_) renaming ([_] to [_]')
import Relation.Binary.Reasoning.Setoid as SR
import Relation.Binary.PropositionalEquality as Eq
open import Relation.Nullary.Decidable using (yes ; no)


open import Function using (_∘_ ; id)
open import Function.Definitions using (Injective)

open import Data.Product using (_×_ ; _,_ ; proj₁ ; proj₂ ; map₁ ; ∃ ; Σ ; Σ-syntax)
open import Data.Product.Relation.Binary.Pointwise.NonDependent as PW using (≡×≡⇒≡ ; Pointwise ; ≡⇒≡×≡)
open import Data.Nat hiding (_^_ ; _+_ ; _*_)
open import Agda.Builtin.Nat using (_-_)
import Data.Nat as Nat
open import Data.Bool hiding (_<_ ; _≤_)
--open import Data.List using () hiding ([_] ; _++_ ; last ; head ; tail ; _∷ʳ_)
open import Data.Vec hiding ([_])
open import Data.Vec as V
open import Data.Fin hiding (_+_ ; _-_ ; _≤_ ; _<_)

open import Data.Maybe
open import Data.Sum using (_⊎_ ; inj₁ ; inj₂ ; [_,_] ; [_,_]′)
open import Data.Unit using (⊤ ; tt)
open import Data.Empty using (⊥ ; ⊥-elim)

open import Word.Base as WB hiding (wfoldl ; _* ; _^'_)
open import Word.Properties
import Presentation.Base as PB
import Presentation.Properties as PP
open PP using (NFProperty ; NFProperty')
import Presentation.CosetNF as CA
import Presentation.Reidemeister-Schreier as RS
module RSF = RS.Star-Injective-Full.Reidemeister-Schreier-Full

open import Presentation.Construct.Base hiding (_*_ ; _⊕_)
import Presentation.Construct.Properties.SemiDirectProduct2 as SDP2
import Presentation.Construct.Properties.DirectProduct as DP
import Presentation.Groups.Cyclic as Cyclic


open import Data.Fin using (Fin ; toℕ ; suc ; zero ; fromℕ)
open import Data.Fin.Properties using (suc-injective ; toℕ-inject₁ ; toℕ-fromℕ)
import Data.Nat.Properties as NP
open import Presentation.GroupLike
open import Presentation.Tactics using ()
open import Data.Nat.Primality



module N.BR2.Three.Lemmas2 (p-2 : ℕ) (p-prime : Prime (2+ p-2))  where

private
  variable
    n : ℕ
    
pattern auto = Eq.refl

pattern ₀ = zero
pattern ₁ = suc ₀
pattern ₂ = suc ₁
pattern ₃ = suc ₂
pattern ₅ = 5
pattern ₆ = 6
pattern ₇ = 7
pattern ₈ = 8
pattern ₉ = 9
pattern ₁₀ = 10
pattern ₁₁ = 11
pattern ₁₂ = 12
pattern ₁₃ = 13
pattern ₁₄ = 14
pattern ₁₅ = 15

pattern ₁₊ ⱼ = suc ⱼ
pattern ₂₊ ⱼ = suc (suc ⱼ)
pattern ₃₊ ⱼ = suc (suc (suc ⱼ))
pattern ₄₊ ⱼ = suc (suc (suc (suc ⱼ)))


open import Zp.ModularArithmetic
open PrimeModulus p-2 p-prime
open import N.Cosets p-2 p-prime
open import N.Symplectic p-2 p-prime
open Symplectic renaming (M to ZM)
open import N.NF1-Sym p-2 p-prime
open import N.LM-Sym p-2 p-prime

open import N.Action p-2 p-prime
open import N.Action-Lemmas p-2 p-prime
open import Algebra.Properties.Ring (+-*-ring p-2)
open import N.NF2-Sym p-2 p-prime
open LM2


open import Zp.ModularArithmetic
open import N.Lemmas-2Qupit-Sym p-2 p-prime
open import N.NF2-Sym p-2 p-prime
--open Lemmas-2Q 2

open import N.NF1 p-2 p-prime
open import N.Ex-Sym p-2 p-prime
open import N.Ex-Sym1 p-2 p-prime
open import N.Ex-Sym2 p-2 p-prime
open import N.Ex-Sym3 p-2 p-prime
open import N.Ex-Sym4 p-2 p-prime
open import N.Ex-Sym5 p-2 p-prime hiding (module L0)
open import N.Ex-Sym2n p-2 p-prime
open import N.Ex-Sym3n p-2 p-prime
open import N.Ex-Sym4n p-2 p-prime

open import N.Lemma-Comm-n p-2 p-prime 0
open import N.Completeness1-Sym p-2 p-prime renaming (module Completeness to Cp1)
open Lemmas0a
open Lemmas0a1
open Lemmas0b
open Lemmas0c
open Lemmas-Sym
open Duality

open import N.Completeness1-Sym p-2 p-prime renaming (module Completeness to CP1) using ()
open import N.Coset2-Update-Sym p-2 p-prime renaming (module Completeness to CP2) using ()
open import N.Lemmas4-Sym p-2 p-prime
open import N.Lemmas-3Q p-2 p-prime
open import N.Pushing.DH p-2 p-prime
open import N.Duality p-2 p-prime
open import N.BR2.Calculations p-2 p-prime
open import N.BR2.Three.Lemmas p-2 p-prime

open PB (3 QRel,_===_)
open PP (3 QRel,_===_)
-- module B2 = PB (2 QRel,_===_)
-- module P2 = PP (2 QRel,_===_)
-- module B1 = PB (1 QRel,_===_)
-- module P1 = PP (1 QRel,_===_)
open SR word-setoid
open Pattern-Assoc
open Lemmas0 1
open Lemmas-2Q 1
--module L2Q0 = Lemmas-2Q 0
open Sym0-Rewriting 2
open Rewriting-Powers 2
open Rewriting-Swap 2
open Rewriting-Swap0 2
open Symplectic-GroupLike
open Basis-Change _ (3 QRel,_===_) grouplike
open import N.EX-Rewriting p-2 p-prime
open Rewriting-EX 2
open Homo 2
open Commuting-Symplectic 1
open import Data.List
open import N.BR2.TwoQupit p-2 p-prime
module L00 = Lemmas0 0


aux-CZ02^-alt-N : ∀ k -> CZ02 ^ k ≈ Ex ↑ • CZ ^ k • Ex ↑
aux-CZ02^-alt-N k@0 = rewrite-swap 100 auto
aux-CZ02^-alt-N k@1 = sym lemma-CZ02-alt
aux-CZ02^-alt-N k@(₁₊ k'@(₁₊ k'')) = begin
  CZ02 ^ k ≈⟨ refl ⟩
  CZ02 • CZ02 ^ k' ≈⟨ cong (sym lemma-CZ02-alt) (aux-CZ02^-alt-N k') ⟩
  (Ex ↑ • CZ • Ex ↑) • Ex ↑ • CZ ^ k' • Ex ↑ ≈⟨ sa (□ ^ 3 • □ ^ 3) ((□ ^ 4) • □ ^ 2) auto ⟩
  (Ex ↑ • CZ • Ex ↑ • Ex ↑) • CZ ^ k' • Ex ↑ ≈⟨ cleft rewrite-swap 100 auto ⟩
  (Ex ↑ • CZ) • CZ ^ k' • Ex ↑ ≈⟨ sa (□ ^ 2 • □ ^ 2) (□ • □ ^ 2 • □) auto ⟩
  Ex ↑ • (CZ • CZ ^ k') • Ex ↑ ≈⟨ refl ⟩
  Ex ↑ • CZ ^ k • Ex ↑ ∎

aux-CZ02^-alt-def-N : ∀ k -> Ex • (CZ ^ k) ↑ • Ex ≈ CZ02 ^ k
aux-CZ02^-alt-def-N k@0 = rewrite-swap 100 auto
aux-CZ02^-alt-def-N k@1 = rewrite-swap 100 auto
aux-CZ02^-alt-def-N k@(₁₊ k'@(₁₊ k'')) = begin
  Ex • (CZ ^ k) ↑ • Ex ≈⟨ refl ⟩
  Ex • (CZ • CZ ^ k') ↑ • Ex ≈⟨ sa (□ • □ ^ 2 • □) (□ ^ 2 • □ ^ 2) auto ⟩
  (Ex • CZ ↑) • (CZ ^ k') ↑ • Ex ≈⟨ cleft rewrite-swap 100 auto ⟩
  (CZ02 • Ex) • (CZ ^ k') ↑ • Ex ≈⟨ assoc ⟩
  CZ02 • Ex • (CZ ^ k') ↑ • Ex ≈⟨ cright aux-CZ02^-alt-def-N k' ⟩
  CZ02 • CZ02 ^ k' ≈⟨ refl ⟩
  CZ02 ^ k ∎

aux-CZ02^-alt-def : ∀ k -> CZ02^ k ≈ CZ02 ^ toℕ k
aux-CZ02^-alt-def k = aux-CZ02^-alt-def-N (toℕ k)

aux-CZ02^-alt : ∀ k -> CZ02^ k ≈ Ex ↑ • CZ^ k • Ex ↑
aux-CZ02^-alt k = begin
  CZ02^ k ≈⟨ aux-CZ02^-alt-def k ⟩
  CZ02 ^ toℕ k ≈⟨ aux-CZ02^-alt-N (toℕ k) ⟩
  Ex ↑ • CZ^ k • Ex ↑ ∎


aux-CZ-H↑-CZ↑^k : ∀ k -> CZ • H ↑ • CZ^ k ↑ ≈ CX^ (- k) ↑ • CZ02^ (- k) • CZ • H ↑
aux-CZ-H↑-CZ↑^k k = bbc (Ex ↑) (Ex ↑) claim
  where
  claim : Ex ↑ • (CZ • H ↑ • CZ^ k ↑) • Ex ↑ ≈ Ex ↑ • (CX^ (- k) ↑ • CZ02^ (- k) • CZ • H ↑) • Ex ↑
  claim = begin
    Ex ↑ • (CZ • H ↑ • CZ^ k ↑) • Ex ↑ ≈⟨ sa (□ • □ ^ 3 • □) (□ ^ 3 • □ ^ 2) auto ⟩
    (Ex ↑ • CZ • H ↑) • CZ^ k ↑ • Ex ↑ ≈⟨ cright lemma-cong↑ _ _ (P2.word-comm (toℕ k) 1 lemma-comm-Ex-CZ-n) ⟩
    (Ex ↑ • CZ • H ↑) • Ex ↑ • CZ^ k ↑ ≈⟨ sa (□ ^ 3 • □ ^ 2) (□ ^ 4 • □) auto ⟩
    (Ex ↑ • CZ • H ↑ • Ex ↑) • CZ^ k ↑ ≈⟨ cleft rewrite-swap 100 auto ⟩
    ((Ex ↑ • CZ • Ex ↑) • H ↑ ↑) • CZ^ k ↑ ≈⟨ cleft cleft lemma-CZ02-alt ⟩
    (CZ02 • H ↑ ↑) • CZ^ k ↑ ≈⟨ assoc ⟩
    CZ02 • H ↑ ↑ • CZ^ k ↑ ≈⟨ aux-CZ02-H-CZ↑ k ⟩
    XC'^ (- k) ↑ • CZ^ (- k) • CZ02 • H ↑ ↑ ≈⟨ cleft sym (lemma-cong↑ _ _ (aux-XC^-XC'^ (- k))) ⟩
    XC^ (- k) ↑ • CZ^ (- k) • CZ02 • H ↑ ↑ ≈⟨ cright cright cleft sym lemma-CZ02-alt ⟩
    XC^ (- k) ↑ • CZ^ (- k) • (Ex ↑ • CZ • Ex ↑) • H ↑ ↑ ≈⟨ cright sym left-unit ⟩
    XC^ (- k) ↑ • ε • CZ^ (- k) • (Ex ↑ • CZ • Ex ↑) • H ↑ ↑ ≈⟨ cright cong (rewrite-swap 100 auto) (cright rewrite-swap 100 auto) ⟩
    XC^ (- k) ↑ • (Ex ↑ • Ex ↑) • CZ^ (- k) • Ex ↑ • CZ • H ↑ • Ex ↑ ≈⟨ sa (□ • □ ^ 2 • □ ^ 5) (□ ^ 2 • □ ^ 6) auto ⟩
    (XC^ (- k) ↑ • Ex ↑) • Ex ↑ • CZ^ (- k) • Ex ↑ • CZ • H ↑ • Ex ↑ ≈⟨ sym (cleft lemma-cong↑ _ _ (aux-Ex-CX^k (- k))) ⟩
    (Ex ↑ • CX^ (- k) ↑) • Ex ↑ • CZ^ (- k) • Ex ↑ • CZ • H ↑ • Ex ↑ ≈⟨ sa (□ ^ 2 • □ ^ 6) (□ • □ • □ ^ 3 • □ ^ 3) auto ⟩
    Ex ↑ • CX^ (- k) ↑ • (Ex ↑ • CZ^ (- k) • Ex ↑) • CZ • H ↑ • Ex ↑ ≈⟨ cright cright cleft sym (aux-CZ02^-alt (- k)) ⟩
    Ex ↑ • CX^ (- k) ↑ • CZ02^ (- k) • CZ • H ↑ • Ex ↑ ≈⟨ sa (□ ^ 6) (□ • □ ^ 4 • □) auto ⟩
    Ex ↑ • (CX^ (- k) ↑ • CZ02^ (- k) • CZ • H ↑) • Ex ↑ ∎


lemma-comm-CZ02-CX : CZ02 • CX ↑ ≈ CX ↑ • CZ02
lemma-comm-CZ02-CX = bbc (Ex ↑) (Ex ↑) claim
  where
  claim : Ex ↑ • (CZ02 • CX ↑) • Ex ↑ ≈ Ex ↑ • (CX ↑ • CZ02) • Ex ↑
  claim = begin
    Ex ↑ • (CZ02 • CX ↑) • Ex ↑ ≈⟨ cright cleft cleft sym lemma-CZ02-alt ⟩
    Ex ↑ • ((Ex ↑ • CZ • Ex ↑) • CX ↑) • Ex ↑ ≈⟨ rewrite-swap 100 auto ⟩
    CZ • XC ↑ ≈⟨ general-comm auto ⟩
    XC ↑ • CZ ≈⟨ rewrite-swap 100 auto ⟩
    Ex ↑ • (CX ↑ • (Ex ↑ • CZ • Ex ↑)) • Ex ↑ ≈⟨ cright cleft cright lemma-CZ02-alt ⟩
    Ex ↑ • (CX ↑ • CZ02) • Ex ↑ ∎

aux-comm-CZ02-CZ02^ : ∀ k -> CZ02 • CZ02^ k ≈ CZ02^ k • CZ02
aux-comm-CZ02-CZ02^ k = begin
  CZ02 •  Ex • CZ^ k ↑ • Ex ≈⟨ refl ⟩
  (Ex • CZ ↑ • Ex) • Ex • CZ^ k ↑ • Ex ≈⟨ sa (□ ^ 3 • □ ^ 3) (□ ^ 4 • □ ^ 2) auto ⟩
  (Ex • CZ ↑ • Ex • Ex) • CZ^ k ↑ • Ex ≈⟨ cleft rewrite-swap 100 auto ⟩
  (Ex • CZ ↑) • CZ^ k ↑ • Ex ≈⟨ sa (□ ^ 2 • □ ^ 2) (□ • □ ^ 2 • □) auto ⟩
  Ex • (CZ ↑ • CZ^ k ↑) • Ex ≈⟨ cright cleft lemma-cong↑ _ _ (P2.word-comm 1 (toℕ k) B2.refl) ⟩
  Ex • (CZ^ k ↑ • CZ ↑) • Ex ≈⟨ sa  (□ • □ ^ 2 • □) (□ ^ 4) auto ⟩
  Ex • CZ^ k ↑ • CZ ↑ • Ex ≈⟨ cright cright rewrite-swap 100 auto ⟩
  Ex • CZ^ k ↑ • Ex • Ex • CZ ↑ • Ex ≈⟨ sa (□ ^ 6) (□ ^ 3 • □ ^ 3) auto ⟩
  CZ02^ k • CZ02 ∎


lemma-|||-mmh : ∀ m↑ k m ->
  let
  m⁻¹ = (m ⁻¹) .proj₁
  m↑/m = m⁻¹ * m↑ .proj₁
  in
  
  CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ • ⟦ m , HS^ k ⟧ₘ₊ ↑ • CZ ↑ ≈ (CX^ (- m↑/m) ↑ • CZ02^ (- m↑/m)) • CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ • ⟦ m , HS^ k ⟧ₘ₊ ↑
  
lemma-|||-mmh m↑@(m↑' , nz↑) k  m@(m' , nz) = begin
  CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ • ⟦ m , HS^ k ⟧ₘ₊ ↑ • CZ ↑ ≈⟨ cright cright cright special-assoc (□ ^ 3 • □) (□ ^ 4) auto ⟩
  CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ • ⟦ m ⟧ₘ ↑ • H ↑ • S^ k ↑ • CZ ↑ ≈⟨ cright cright cright cright (cright lemma-cong↑ _ _ (P2.word-comm (toℕ k) 1 (B2.sym (B2.axiom comm-CZ-S↓)))) ⟩
  CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ • ⟦ m ⟧ₘ ↑ • H ↑ • CZ ↑ • S^ k ↑ ≈⟨ sa (□ ^ 7) (□ ^ 3 • □ ^ 2 • □ ^ 2) auto ⟩
  (CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ) • (⟦ m ⟧ₘ ↑ • H ↑) • CZ ↑ • S^ k ↑ ≈⟨ cright cleft lemma-cong↑ _ _ (B2.sym (semi-HM' m)) ⟩
  (CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ) • (H ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ ) • CZ ↑ • S^ k ↑ ≈⟨ cright sa (□ ^ 2 • □ ^ 2) (□ • □ ^ 2 • □) auto ⟩
  (CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ) • H ↑ • (⟦ m ⁻¹ ⟧ₘ ↑ • CZ ↑) • S^ k ↑ ≈⟨ cright cright cleft lemma-cong↑ _ _ (B2.axiom (semi-M↓CZ (m ⁻¹))) ⟩
  (CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ) • H ↑ • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ k ↑ ≈⟨ cleft cright sym (lemma-comm-CZ-w↑↑ ⟦ m↑ ⟧ₘ) ⟩
  (CZ02 • CZ • ⟦ m↑ ⟧ₘ ↑ ↑) • H ↑ • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ k ↑ ≈⟨ sa (□ ^ 3 • □ ^ 2) (□ ^ 2 • □ ^ 2 • □) auto ⟩
  (CZ02 • CZ) • (⟦ m↑ ⟧ₘ ↑ ↑ • H ↑) • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ k ↑ ≈⟨ sym (cright cleft lemma-cong↑ _ _ (lemma-comm-H-w↑ ⟦ m↑ ⟧ₘ)) ⟩
  (CZ02 • CZ) • (H ↑ • ⟦ m↑ ⟧ₘ ↑ ↑) • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ k ↑ ≈⟨ cright sa (□ ^ 2 • □ ^ 2 • □) (□ • □ ^ 2 • □ ^ 2) auto ⟩
  (CZ02 • CZ) • H ↑ • (⟦ m↑ ⟧ₘ ↑ ↑ • CZ^ m⁻¹ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ cright cright cleft lemma-cong↑ _ _ (L2Q0.lemma-M↑CZ^k m↑' m⁻¹ nz↑) ⟩
  (CZ02 • CZ) • H ↑ • (CZ^ (m⁻¹ * m↑') ↑ • ⟦ m↑ ⟧ₘ ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ sa (□ ^ 2 • □ • □ ^ 2 • □) (□ ^ 4 • □ ^ 2) auto ⟩
  (CZ02 • CZ • H ↑ • CZ^ (m⁻¹ * m↑') ↑) • ⟦ m↑ ⟧ₘ ↑ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ cleft (cright aux-CZ-H↑-CZ↑^k m↑/m) ⟩
  (CZ02 • CX^ (- m↑/m) ↑ • CZ02^ (- m↑/m) • CZ • H ↑) • ⟦ m↑ ⟧ₘ ↑ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ sa (□ ^ 5 • □ ^ 3) (□ ^ 2 • □ • □ • □ ^ 2 • □ ^ 2) auto ⟩
  (CZ02 • CX^ (- m↑/m) ↑) • CZ02^ (- m↑/m) • CZ • (H ↑ • ⟦ m↑ ⟧ₘ ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ cleft cright sym (refl' (lemma-^-↑ CX (toℕ  (- m↑/m)))) ⟩
  (CZ02 • CX ↑ ^ toℕ (- m↑/m)) • CZ02^ (- m↑/m) • CZ • (H ↑ • ⟦ m↑ ⟧ₘ ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ cong (word-comm 1 (toℕ (- m↑/m)) lemma-comm-CZ02-CX) (cright cright cleft lemma-cong↑ _ _ (lemma-comm-H-w↑ ⟦ m↑ ⟧ₘ)) ⟩
  (CX ↑ ^ toℕ (- m↑/m) • CZ02) • CZ02^ (- m↑/m) • CZ • (⟦ m↑ ⟧ₘ ↑ ↑ • H ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ k ↑ ≈⟨ cong (cleft refl' (lemma-^-↑ CX (toℕ (- m↑/m)))) (cright cright sa (□ ^ 2 • □ ^ 2 ) (□ • □ ^ 2 • □) auto) ⟩
  (CX^ (- m↑/m) ↑ • CZ02) • CZ02^ (- m↑/m) • CZ • ⟦ m↑ ⟧ₘ ↑ ↑ • (H ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ k ↑ ≈⟨ cright cright cright cright  cleft sym (lemma-cong↑ _ _ (B2.sym (semi-HM' m))) ⟩
  (CX^ (- m↑/m) ↑ • CZ02) • CZ02^ (- m↑/m) • CZ • ⟦ m↑ ⟧ₘ ↑ ↑ • (⟦ m ⟧ₘ ↑ • H ↑) • S^ k ↑ ≈⟨ sa (□ ^ 2 • □ ^ 2) (□ • □ ^ 2 • □) auto ⟩
  CX^ (- m↑/m) ↑ • (CZ02 • CZ02^ (- m↑/m)) • CZ • ⟦ m↑ ⟧ₘ ↑ ↑ • (⟦ m ⟧ₘ ↑ • H ↑) • S^ k ↑ ≈⟨ cright cleft  aux-comm-CZ02-CZ02^ ((- m↑/m)) ⟩
  CX^ (- m↑/m) ↑ • (CZ02^ (- m↑/m) • CZ02) • CZ • ⟦ m↑ ⟧ₘ ↑ ↑ • (⟦ m ⟧ₘ ↑ • H ↑) • S^ k ↑ ≈⟨ cright cright sym assoc ⟩
  CX^ (- m↑/m) ↑ • (CZ02^ (- m↑/m) • CZ02) • (CZ • ⟦ m↑ ⟧ₘ ↑ ↑) • (⟦ m ⟧ₘ ↑ • H ↑) • S^ k ↑ ≈⟨ cright cright cleft lemma-comm-CZ-w↑↑ ⟦ m↑ ⟧ₘ ⟩
  CX^ (- m↑/m) ↑ • (CZ02^ (- m↑/m) • CZ02) • (⟦ m↑ ⟧ₘ ↑ ↑ • CZ) • (⟦ m ⟧ₘ ↑ • H ↑) • S^ k ↑ ≈⟨ sa (□ • □ ^ 2 • □ ^ 2 • □ ^ 2 • □) (□ ^ 2 • □ ^ 6) auto ⟩
  (CX^ (- m↑/m) ↑ • CZ02^ (- m↑/m)) • CZ02 • ⟦ m↑ ⟧ₘ ↑ ↑ • CZ • ⟦ m , HS^ k ⟧ₘ₊ ↑ ∎
  where
  m⁻¹ = (m ⁻¹) .proj₁
  m↑/m = m⁻¹ * m↑ .proj₁

aux-EX-S^k : ∀ k -> Ex • S^ k ≈ S^ k ↑ • Ex
aux-EX-S^k k = begin
  Ex • S^ k ≈⟨ lemma-Induction lemma-Ex-S (toℕ k) ⟩
  S ↑ ^ toℕ k • Ex ≈⟨ cleft refl' (lemma-^-↑ S (toℕ k)) ⟩
  S^ k ↑ • Ex ∎

aux-CZ02H↑↑CZ02^k : ∀ (k*@(k , nz) : ℤ* ₚ) -> let -2k = - k + - k in
  CZ02 • H ↑ ↑ • CZ02^ k ≈ (S^ -2k • H ↑ ↑ • CZ02^ k • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑
aux-CZ02H↑↑CZ02^k k*@(k , nz) = bbc Ex Ex claim
  where
  -2k = - k + - k
  claim : Ex • (CZ02 • H ↑ ↑ • CZ02^ k) • Ex ≈ Ex • ((S^ -2k • H ↑ ↑ • CZ02^ k • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑) • Ex
  claim = begin
    Ex • (CZ02 • H ↑ ↑ • CZ02^ k) • Ex ≈⟨ sa (□ • □ ^ 5 • □) (□ ^ 4 • □ ^ 3) auto ⟩
    (Ex • CZ02 • H ↑ ↑ • Ex) • CZ^ k ↑ • Ex • Ex ≈⟨ cong (rewrite-swap 100 auto) (cright rewrite-swap 100 auto) ⟩
    (CZ ↑ • H ↑ ↑) • CZ^ k ↑ • ε ≈⟨ trans (cong refl right-unit) assoc ⟩
    CZ ↑ • H ↑ ↑ • CZ^ k ↑ ≈⟨ lemma-cong↑ _ _ (aux-CZ-H↑-CZ^k k*) ⟩
    (S^ -2k ↑ • H ↑ ↑ • CZ^ k ↑ • H ↑ ↑ ^ 3) • CZ ↑ • H ↑ ↑ ≈⟨ sa (□ ^ 4 • □ ^ 2) (□ ^ 6) auto ⟩
    S^ -2k ↑ • H ↑ ↑ • CZ^ k ↑ • H ↑ ↑ ^ 3 • CZ ↑ • H ↑ ↑ ≈⟨ cright cong ( rewrite-swap 100 auto) (cright refl) ⟩
    S^ -2k ↑ • (Ex • H ↑ ↑ • Ex) • CZ^ k ↑ • H ↑ ↑ ^ 3 • CZ ↑  • H ↑ ↑ ≈⟨ sa (□ • □ ^ 3 • □ ^ 4) (□ ^ 2 • □ ^ 2 • □ ^ 4) auto ⟩
    (S^ -2k ↑ • Ex) • (H ↑ ↑ • Ex) • CZ^ k ↑ • H ↑ ↑ ^ 3 • CZ ↑  • H ↑ ↑ ≈⟨ cright cright cright rewrite-swap 100 auto ⟩
    (S^ -2k ↑ • Ex) • (H ↑ ↑ • Ex) • CZ^ k ↑ • Ex • H ↑ ↑ ^ 3 • CZ02 • H ↑ ↑ • Ex ≈⟨ cleft sym (aux-EX-S^k -2k) ⟩
    (Ex • S^ -2k) • (H ↑ ↑ • Ex) • CZ^ k ↑ • Ex • H ↑ ↑ ^ 3 • CZ02 • H ↑ ↑ • Ex ≈⟨ sa (□ ^ 2 • □ ^ 2 • □ ^ 6) (□ • ((□ • □ • □ ^ 3 • □) • □ • □) • □) auto ⟩
    Ex • ((S^ -2k • H ↑ ↑ • CZ02^ k • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑) • Ex ∎

aux-||hh| : ∀ (k*@(k , nz) : ℤ* ₚ) -> let 2k =  k +  k in
  CZ02 • CZ • H ↑ • H ↑ ↑ • CZ^ k ↑ ≈ (S^ 2k • H ↑ ↑ • CZ02^ (- k) • CX^ (- k) ↑ • XC^ k • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ • H ↑ 
aux-||hh| k*@(k , nz) = begin
  CZ02 • CZ • H ↑ • H ↑ ↑ • CZ^ k ↑ ≈⟨ sa (□ ^ 5) (□ ^ 4 • □) auto ⟩
  (CZ02 • CZ • H ↑ • H ↑ ↑) • CZ^ k ↑ ≈⟨ cleft general-comm auto ⟩
  (CZ02 • H ↑ ↑ • CZ • H ↑) • CZ^ k ↑ ≈⟨ sa (□ ^ 4 • □) (□ ^ 2 • □ ^ 3) auto ⟩
  (CZ02 • H ↑ ↑) • CZ • H ↑ • CZ^ k ↑ ≈⟨ cright aux-CZ-H↑-CZ↑^k k ⟩
  (CZ02 • H ↑ ↑) • CX^ (- k) ↑ • CZ02^ (- k) • CZ • H ↑ ≈⟨ cright sym assoc ⟩
  (CZ02 • H ↑ ↑) • (CX^ (- k) ↑ • CZ02^ (- k)) • CZ • H ↑ ≈⟨ cright cleft cong (sym (refl' (lemma-^-↑ CX (toℕ (- k))))) (aux-CZ02^-alt-def (- k)) ⟩
  (CZ02 • H ↑ ↑) • (CX ↑ ^ toℕ (- k) • CZ02'^ (- k)) • CZ • H ↑ ≈⟨ cright cleft word-comm (toℕ (- k)) (toℕ (- k)) (sym lemma-comm-CZ02-CX) ⟩
  (CZ02 • H ↑ ↑) • (CZ02'^ (- k) • CX ↑ ^ toℕ (- k)) • CZ • H ↑ ≈⟨ sa (□ ^ 2 • □ ^ 2 • □ ^ 2) (□ ^ 3 • □ ^ 3) auto ⟩
  (CZ02 • H ↑ ↑ • CZ02'^ (- k)) • CX ↑ ^ toℕ (- k) • CZ • H ↑ ≈⟨ cleft cright cright sym (aux-CZ02^-alt-def (- k)) ⟩
  (CZ02 • H ↑ ↑ • CZ02^ (- k)) • CX ↑ ^ toℕ (- k) • CZ • H ↑ ≈⟨ cleft aux-CZ02H↑↑CZ02^k (- k , (-' k*) .proj₂) ⟩
  ((S^ 2k • H ↑ ↑ • CZ02^ (- k) • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑) • CX ↑ ^ toℕ (- k) • CZ • H ↑ ≈⟨ sa ((□ ^ 4 • □ ^ 2) • □ ) (□ ^ 3 • □ ^ 3 • □) auto ⟩
  (S^ 2k • H ↑ ↑ • CZ02^ (- k)) • (H ↑ ↑ ^ 3 • CZ02 • H ↑ ↑) • CX ↑ ^ toℕ (- k) • CZ • H ↑ ≈⟨ cright cright cleft refl' (lemma-^-↑ CX (toℕ (- k))) ⟩
  (S^ 2k • H ↑ ↑ • CZ02^ (- k)) • (XC02) • CX^ (- k) ↑ • CZ • H ↑ ≈⟨ cright sym assoc ⟩
  (S^ 2k • H ↑ ↑ • CZ02^ (- k)) • (XC02 • CX^ (- k) ↑) • CZ • H ↑ ≈⟨ cright cleft aux-XC02-CX^k↑ (- k) ⟩
  (S^ 2k • H ↑ ↑ • CZ02^ (- k)) • (CX^ (- k) ↑ • XC^ (- - k) • XC02) • CZ • H ↑ ≈⟨ cright cleft cright cleft refl' (Eq.cong XC^ (-‿involutive k)) ⟩
  (S^ 2k • H ↑ ↑ • CZ02^ (- k)) • (CX^ (- k) ↑ • XC^ k • XC02) • CZ • H ↑ ≈⟨ sa (□ ^ 3 • □ ^ 5 • □ ^ 2) (□ ^ 6 • □ ^ 4) auto ⟩
  (S^ 2k • H ↑ ↑ • CZ02^ (- k) • CX^ (- k) ↑ • XC^ k • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ • H ↑  ≈⟨ cleft cleft refl' (Eq.cong S^ (Eq.cong₂ _+_ (-‿involutive k) (-‿involutive k))) ⟩
  (S^ 2k' • H ↑ ↑ • CZ02^ (- k) • CX^ (- k) ↑ • XC^ k • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ • H ↑  ∎
  where
  2k = - - k + - - k
  2k' =  k +  k


lemma-|||-mhmh : ∀ m↑ k m l ->
  let
  m⁻¹ = (m ⁻¹) .proj₁
  m↑/m = m⁻¹ * m↑ .proj₁
  k′* : ℤ* ₚ
  k′* = (m ⁻¹ *' m↑ ⁻¹)
  k′ = k′* .proj₁
  2k′ =  k′ +  k′
  
  in
  
  CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ • ⟦ m  , HS^ l ⟧ₘ₊ ↑ • CZ ↑ ≈ (S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ • ⟦ m  , HS^ l ⟧ₘ₊ ↑

lemma-|||-mhmh m↑@(m↑' , nz↑) k  m@(m' , nz) l = begin
  CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ • ⟦ m  , HS^ l ⟧ₘ₊ ↑ • CZ ↑ ≈⟨ cright cright cright sa (□ ^ 3 • □) (□ ^ 4) auto ⟩
  CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ • ⟦ m ⟧ₘ ↑ • H ↑ • S^ l ↑ • CZ ↑ ≈⟨ cright cright cright cright (cright lemma-cong↑ _ _ (P2.word-comm (toℕ l) 1 (B2.sym (B2.axiom comm-CZ-S↓)))) ⟩
  CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ • ⟦ m ⟧ₘ ↑ • H ↑ • CZ ↑ • S^ l ↑ ≈⟨ sa (□ ^ 7) (□ ^ 3 • □ ^ 2 • □ ^ 2) auto ⟩
  (CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ) • (⟦ m ⟧ₘ ↑ • H ↑) • CZ ↑ • S^ l ↑ ≈⟨ cright cleft lemma-cong↑ _ _ (B2.sym (semi-HM' m)) ⟩
  (CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ) • (H ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ ) • CZ ↑ • S^ l ↑ ≈⟨ cright sa (□ ^ 2 • □ ^ 2) (□ • □ ^ 2 • □) auto ⟩
  (CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ) • H ↑ • (⟦ m ⁻¹ ⟧ₘ ↑ • CZ ↑) • S^ l ↑ ≈⟨ cright cright cleft lemma-cong↑ _ _ (B2.axiom (semi-M↓CZ (m ⁻¹))) ⟩
  (CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ) • H ↑ • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ l ↑ ≈⟨ cleft cright sym (lemma-comm-CZ-w↑↑ ⟦ m↑ , HS^ k ⟧ₘ₊) ⟩
  (CZ02 • CZ • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑) • H ↑ • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ l ↑ ≈⟨ sa (□ ^ 3 • □ ^ 2) (□ ^ 2 • □ ^ 2 • □) auto ⟩
  (CZ02 • CZ) • (⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • H ↑) • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ l ↑ ≈⟨ sym (cright cleft lemma-cong↑ _ _ (lemma-comm-H-w↑ ⟦ m↑ , HS^ k ⟧ₘ₊)) ⟩
  (CZ02 • CZ) • (H ↑ • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑) • (CZ^ m⁻¹ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ l ↑ ≈⟨ cright sa (□ ^ 2 • □ ^ 2 • □) (□ • □ ^ 2 • □ ^ 2) auto ⟩
  (CZ02 • CZ) • H ↑ • (⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ^ m⁻¹ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright cright cleft sa (□ ^ 3 • □) (□ ^ 4) auto ⟩
  (CZ02 • CZ) • H ↑ • (⟦ m↑ ⟧ₘ ↑ ↑ • H ↑ ↑ • S^ k ↑ ↑ • CZ^ m⁻¹ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright cright cleft cright cright sym (aux-comm-CZ↑-S↑↑ m⁻¹ k) ⟩
  (CZ02 • CZ) • H ↑ • (⟦ m↑ ⟧ₘ ↑ ↑ • H ↑ ↑ • CZ^ m⁻¹ ↑ • S^ k ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright cright cleft sym assoc ⟩
  (CZ02 • CZ) • H ↑ • ((⟦ m↑ ⟧ₘ ↑ ↑ • H ↑ ↑) • CZ^ m⁻¹ ↑ • S^ k ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright cright cleft cleft lemma-cong↑ _ _ (lemma-cong↑ _ _ (B1.sym (semi-HM' m↑))) ⟩
  (CZ02 • CZ) • H ↑ • ((H ↑ ↑ • ⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ ) • CZ^ m⁻¹ ↑ • S^ k ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ sa (□ ^ 2 • □ • (□ ^ 2 • □ ^ 2) • □) (□ ^ 4 • □ ^ 2 • □ ^ 2) auto ⟩
  (CZ02 • CZ • H ↑ • H ↑ ↑) • (⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • CZ^ m⁻¹ ↑) • S^ k ↑ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright cleft lemma-cong↑ _ _ (L2Q0.lemma-M↑CZ^k m↑⁻¹ m⁻¹ ((m↑ ⁻¹) .proj₂)) ⟩
  (CZ02 • CZ • H ↑ • H ↑ ↑) • (CZ^ (m⁻¹ * m↑⁻¹) ↑ • ⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑) • S^ k ↑ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ sa (□ ^ 4 • □ ^ 2 • □) (□ ^ 5 • □ ^ 2) auto ⟩
  (CZ02 • CZ • H ↑ • H ↑ ↑ • CZ^ (m⁻¹ * m↑⁻¹) ↑) • ⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • S^ k ↑ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cleft aux-||hh| k′* ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ • H ↑ ) • ⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • S^ k ↑ ↑ • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ sa (□ ^ 5 • □ ^ 3) (□ ^ 4 • □ ^ 3 • □) auto ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ) • (H ↑ • ⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • S^ k ↑ ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright cleft lemma-cong↑ _ _ (lemma-comm-H-w↑ (⟦ m↑ ⁻¹ ⟧ₘ  • S^ k)) ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ) • ((⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • S^ k ↑ ↑) • H ↑) • ⟦ m ⁻¹ ⟧ₘ ↑ • S^ l ↑ ≈⟨ cright sa (□ ^ 2 • □ ^ 2) (□ • □ ^ 2 • □) auto ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • H ↑ ↑ • CZ) • (⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • S^ k ↑ ↑) • (H ↑ • ⟦ m ⁻¹ ⟧ₘ ↑) • S^ l ↑ ≈⟨ cong (cright cong refl (axiom comm-CZ)) (cright (cleft lemma-cong↑ _ _ ( (semi-HM' m)))) ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • CZ • H ↑ ↑) • (⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑ • S^ k ↑ ↑) • (⟦ m ⟧ₘ ↑ • H ↑) • S^ l ↑ ≈⟨ sa (□ ^ 4 • □ ^ 2 • □) (□ ^ 3 • □ ^ 2 • □ ^ 2) auto ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • CZ) • (H ↑ ↑ • ⟦ m↑ ⁻¹ ⟧ₘ ↑ ↑) • S^ k ↑ ↑ • (⟦ m ⟧ₘ ↑ • H ↑) • S^ l ↑ ≈⟨ cright cleft  lemma-cong↑ _ _ (lemma-cong↑ _ _ ( (semi-HM' m↑))) ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • CZ) • (⟦ m↑ ⟧ₘ ↑ ↑ • H ↑ ↑) • S^ k ↑ ↑ • (⟦ m ⟧ₘ ↑ • H ↑) • S^ l ↑ ≈⟨ cright sa (□ ^ 2 • □ • □ ^ 2 • □) (□ ^ 3 • □ ^ 3) auto ⟩
  ((S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • CZ) • (⟦ m↑  ⟧ₘ ↑ ↑ • H ↑ ↑ • S^ k ↑ ↑) • (⟦ m ⟧ₘ ↑ • H ↑ • S^ l ↑) ≈⟨ sa (□ ^ 3 • □ ^ 2) (□ • □ • □ ^ 2 • □) auto ⟩
  (S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • (CZ • (⟦ m↑  ⟧ₘ ↑ ↑ • H ↑ ↑ • S^ k ↑ ↑)) • (⟦ m ⟧ₘ ↑ • H ↑ • S^ l ↑) ≈⟨ cright cright (cleft lemma-comm-CZ-w↑↑ (⟦ m↑  ⟧ₘ  • H  • S^ k )) ⟩
  (S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • ((⟦ m↑  ⟧ₘ ↑ ↑ • H ↑ ↑ • S^ k ↑ ↑) • CZ) • (⟦ m ⟧ₘ ↑ • H ↑ • S^ l ↑) ≈⟨ cright cright assoc ⟩
  (S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • (⟦ m↑  ⟧ₘ ↑ ↑ • H ↑ ↑ • S^ k ↑ ↑) • CZ • (⟦ m ⟧ₘ ↑ • H ↑ • S^ l ↑) ≈⟨ refl ⟩
  
  (S^ 2k′ • H ↑ ↑ • CZ02^ (- k′) • CX^ (- k′) ↑ • XC^ k′ • H ↑ ↑ ^ 3) • CZ02 • ⟦ m↑ , HS^ k ⟧ₘ₊ ↑ ↑ • CZ • ⟦ m  , HS^ l ⟧ₘ₊ ↑ ∎
  where
  m⁻¹ = (m ⁻¹) .proj₁
  m↑⁻¹ = (m↑ ⁻¹) .proj₁
  m↑/m = m⁻¹ * m↑ .proj₁
  k′* : ℤ* ₚ
  k′* = (m ⁻¹ *' m↑ ⁻¹)
  k′ = k′* .proj₁
  2k′ =  k′ +  k′
  
